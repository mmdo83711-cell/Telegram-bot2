<!DOCTYPE html>
<html lang="en">
    <script async="async" data-cfasync="false" src="https://pl28087364.effectivegatecpm.com/5f0b65d762714132d66c6ba8945349f3/invoke.js"></script>
<div id="container-5f0b65d762714132d66c6ba8945349f3"></div>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Earning App</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Firebase SDK (REQUIRED for Admin Control) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- External Ad Scripts -->
    <script async="async" data-cfasync="false" src="https://pl28087364.effectivegatecpm.com/5f0b65d762714132d66c6ba8945349f3/invoke.js"></script>
    <div id="container-5f0b65d762714132d66c6ba8945349f3"></div>    

    <style>
        /* CSS STYLES (UNCHANGED) */
        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --background-color: #f0f2f5;
            --card-background: #ffffff;
            --text-color: #333333;
            --light-text-color: #888888;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding-bottom: 60px;
            color: var(--text-color);
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            background-color: var(--card-background);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: var(--card-background);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            border: 2px solid var(--primary-color);
            background-color: #eee;
            object-fit: cover;
        }

        .header-user-info { flex-grow: 1; }
        .header-user-info h3 { margin: 0; font-size: 16px; font-weight: 600; }

        .user-id-wrapper {
            display: flex; align-items: center; font-size: 11px;
            color: var(--light-text-color); margin-top: 2px;
        }
        .copy-icon { font-size: 12px; margin-left: 5px; cursor: pointer; color: var(--primary-color); }
        
        .content { flex-grow: 1; padding: 20px; overflow-y: auto; }

        .card {
            background-color: var(--background-color);
            border-radius: 12px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            text-align: center; border: 1px solid var(--border-color);
        }

        .card-header {
            font-size: 18px; font-weight: 600; margin-bottom: 15px;
            color: var(--text-color); display: flex; align-items: center; justify-content: center;
        }
        
        .card-header .material-icons, .card-header .fa-solid, .card-header .fa-brands {
            margin-right: 8px; color: var(--primary-color);
        }

        .balance-card .balance {
            font-size: 36px; font-weight: 700; color: var(--secondary-color); margin: 10px 0;
        }

        .dashboard-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
        }

        .dashboard-item {
            background-color: var(--card-background); border-radius: 12px;
            padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); text-align: center;
        }

        .dashboard-item-value { font-size: 24px; font-weight: 700; color: var(--text-color); }
        .dashboard-item-label { font-size: 12px; color: var(--light-text-color); }

        .primary-btn, .secondary-btn {
            border: none; padding: 15px; border-radius: 10px; font-size: 16px;
            font-weight: 600; cursor: pointer; width: 100%;
            transition: background-color 0.3s, transform 0.2s;
            margin-top: 20px; display: inline-flex; align-items: center;
            justify-content: center; gap: 8px; text-decoration: none; box-sizing: border-box;
        }
        
        .primary-btn { background-color: var(--primary-color); color: #fff; }
        .primary-btn:hover { background-color: #0056b3; transform: translateY(-2px); }
        .primary-btn:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }

        .secondary-btn { background-color: #f0f0f0; color: var(--text-color); border: 1px solid var(--border-color); }
        .secondary-btn:hover { background-color: #e0e0e0; transform: translateY(-2px); }
        
        .progress-bar-container {
            height: 10px; background-color: #eee; border-radius: 5px; overflow: hidden; margin-top: 10px;
        }
        .progress-bar {
            height: 100%; background-color: var(--primary-color); width: 0; transition: width 0.5s ease-in-out;
        }

        .footer-nav {
            display: flex; justify-content: space-around; align-items: center;
            position: fixed; bottom: 0; width: 100%; max-width: 450px;
            background-color: var(--card-background); border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        }

        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            padding: 10px; cursor: pointer; color: var(--light-text-color); flex: 1;
        }
        .nav-item.active { color: var(--primary-color); }
        .nav-item-label { font-size: 12px; font-weight: 500; }

        .page { display: none; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .profile-info, .withdraw-form-container, .support-form-container {
            background-color: var(--card-background); border-radius: 12px;
            padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-top: 20px; border: 1px solid var(--border-color);
        }
        
        .profile-pic-container {
            width: 80px; height: 80px; border-radius: 50%; background-color: #eee;
            margin: 0 auto 15px; overflow: hidden; border: 3px solid var(--primary-color);
        }
        .profile-pic { width: 100%; height: 100%; object-fit: cover; }
        
        .profile-info-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0; border-bottom: 1px solid #f0f0f0;
        }
        .profile-value { font-size: 16px; font-weight: 600; color: var(--primary-color); }

        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 14px; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);
        }

        /* Modal Styles */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);
            align-items: center; justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: #fff; padding: 25px; border-radius: 15px;
            width: 85%; max-width: 400px; text-align: center; position: relative;
        }
        .close-modal-btn {
            position: absolute; top: 10px; right: 15px; font-size: 28px;
            font-weight: bold; color: #888; cursor: pointer;
        }
        .upload-section { margin-top: 15px; text-align: left; border-top: 1px solid #eee; padding-top: 15px; }
        .file-input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; }
        
        /* Notice Banner */
        .admin-notice {
            background-color: #fff3cd; color: #856404; padding: 10px;
            border-radius: 8px; margin-bottom: 15px; font-size: 13px;
            border: 1px solid #ffeeba; text-align: center; display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <img id="header-profile-pic" src="https://via.placeholder.com/40" alt="Profile" class="header-profile-pic">
            <div class="header-user-info">
                <h3 id="header-user-name">User</h3>
                <div class="user-id-wrapper">
                    ID: <span id="header-user-id">...</span>
                    <span class="material-icons copy-icon" id="header-copy-btn" title="Copy ID">content_copy</span>
                </div>
            </div>
        </header>

        <main class="content">
            <!-- Admin Notice Banner -->
            <div id="admin-notice-banner" class="admin-notice"></div>

            <section id="home-page" class="page active">
                <div class="card balance-card">
                    <h2 class="card-header">
                        <span class="material-icons">account_balance_wallet</span>
                        My Balance
                    </h2>
                    <div class="balance" id="current-balance">BDT 0.00</div>
                    <button class="primary-btn" id="start-earning-btn">
                        Start Earning Now <span class="material-icons">arrow_forward</span>
                    </button>
                    <button class="secondary-btn" id="withdraw-btn">
                        Withdraw <span class="material-icons">currency_exchange</span>
                    </button>
                </div>
                <div class="dashboard-grid">
                    <div class="dashboard-item">
                        <span class="material-icons" style="color: var(--secondary-color);">attach_money</span>
                        <div class="dashboard-item-value" id="total-earnings">BDT 0.00</div>
                        <div class="dashboard-item-label">Total Earnings</div>
                    </div>
                    <div class="dashboard-item">
                        <span class="material-icons" style="color: #ffc107;">visibility</span>
                        <div class="dashboard-item-value" id="ads-watched">0</div>
                        <div class="dashboard-item-label">Total Ads Watched</div>
                    </div>
                </div>
            </section>

            <section id="earn-page" class="page">
                <!-- Hourly Progress -->
                <div class="card" style="padding: 15px;">
                     <div style="text-align: left; margin-bottom: 10px;">
                        <div style="font-size: 14px; font-weight: 600;">Hourly Task Progress:</div>
                        <div style="font-size: 12px; color: var(--light-text-color);" id="ad-progress-text">Completed: 0 / 20</div>
                        <div id="reset-timer-display" style="font-size: 12px; color: #d32f2f; display: none; font-weight: bold;"></div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="ad-progress-bar"></div>
                    </div>
                </div>

                <!-- Dynamic Task Sections -->
                <div class="card">
                    <h2 class="card-header"><span class="material-icons">task</span> Premium Task 1</h2>
                    <button class="primary-btn" id="task-btn-1">Start Task 1 <span class="material-icons">open_in_new</span></button>
                </div>
                <div class="card">
                    <h2 class="card-header"><span class="material-icons">verified</span> Premium Task 2</h2>
                    <button class="primary-btn" id="task-btn-2">Start Task 2 <span class="material-icons">open_in_new</span></button>
                </div>
                <div class="card">
                    <h2 class="card-header"><span class="material-icons">star</span> Premium Task 3</h2>
                    <button class="primary-btn" id="task-btn-3">Start Task 3 <span class="material-icons">open_in_new</span></button>
                </div>
                <div class="card" style="border: 2px solid var(--secondary-color);">
                    <h2 class="card-header"><span class="material-icons" style="color: var(--secondary-color);">camera_alt</span> Banner Task 4</h2>
                    <button class="primary-btn" id="task-btn-4" style="background-color: var(--secondary-color);">Start Task 4</button>
                </div>
                <div class="card" style="border: 2px solid #000;">
                    <h2 class="card-header"><span class="fa-brands fa-tiktok" style="color: #000;"></span> TikTok Follow</h2>
                    <button class="primary-btn" id="task-btn-tiktok" style="background-color: #000;">Follow TikTok</button>
                </div>

                <div class="card">
                    <h2 class="card-header"><span class="fa-brands fa-telegram" style="color: #0088cc;"></span> Community</h2>
                    <a href="https://t.me/earnfree0t" target="_blank" class="secondary-btn" style="width:100%">Join Group</a>
                </div>
            </section>
            
            <section id="withdraw-page" class="page">
                <div class="card">
                    <h2 class="card-header"><span class="material-icons">currency_exchange</span> Withdraw</h2>
                    <div class="balance" id="withdraw-balance-display">BDT 0.00</div>
                    <div class="card-label">Minimum: bKash 100, WebMoney 500</div>
                </div>
                <div class="withdraw-form-container">
                    <form id="withdraw-form">
                        <div class="form-group">
                            <label>Method</label>
                            <select id="withdraw-method" required>
                                <option value="" disabled selected>Select method</option>
                                <option value="bkash">bKash (Min 100)</option>
                                <option value="webmoney">WebMoney (Min 500)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Account Number</label>
                            <input type="text" id="account-number" placeholder="017xxxxxxxx" required>
                        </div>
                        <div class="form-group">
                            <label>Amount (BDT)</label>
                            <input type="number" id="withdraw-amount" placeholder="100" required>
                        </div>
                        <button type="submit" class="primary-btn" id="submit-withdraw-btn">Submit Request</button>
                    </form>
                </div>
            </section>

            <section id="profile-page" class="page">
                <div class="card" style="padding: 30px;">
                    <div class="profile-pic-container">
                        <img id="profile-page-pic" src="https://via.placeholder.com/80" alt="Profile">
                    </div>
                    <h3 id="profile-user-name">User</h3>
                    <div class="user-id-wrapper" style="justify-content: center; margin-top: 5px; font-size: 13px;">
                        ID: <span id="profile-user-id" style="font-weight: bold; color: var(--primary-color);">...</span>
                        <span class="material-icons copy-icon" id="profile-copy-btn">content_copy</span>
                    </div>
                </div>

                <div class="profile-info">
                    <div class="profile-info-row">
                        <span class="profile-label">Current Balance</span>
                        <span class="profile-value" id="profile-balance">BDT 0.00</span>
                    </div>
                    <div class="profile-info-row">
                        <span class="profile-label">Ads Watched</span>
                        <span class="profile-value" id="profile-ads-watched">0</span>
                    </div>
                </div>

                <div class="support-form-container">
                    <h4>Support & Help</h4>
                    <form id="support-form">
                        <div class="form-group">
                            <textarea id="support-message" placeholder="Describe your problem..." required></textarea>
                        </div>
                        <button type="submit" class="secondary-btn" id="send-support-btn">Send Message</button>
                    </form>
                </div>
            </section>
        </main>

        <nav class="footer-nav">
            <div class="nav-item active" data-page="home-page"><span class="material-icons">home</span><span class="nav-item-label">Home</span></div>
            <div class="nav-item" data-page="earn-page"><span class="material-icons">play_circle</span><span class="nav-item-label">Earn</span></div>
            <div class="nav-item" data-page="withdraw-page"><span class="fa-solid fa-credit-card"></span><span class="nav-item-label">Withdraw</span></div>
            <div class="nav-item" data-page="profile-page"><span class="material-icons">person</span><span class="nav-item-label">Profile</span></div>
        </nav>
    </div>

    <!-- NOTICES & MODALS -->
    <div id="task-notice-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">&times;</span>
            <div class="notice-title" style="color:red; font-weight:bold;">üì¢ ‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ</div>
            <div class="notice-body" style="text-align:left; font-size:14px; margin:15px 0;">
                ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶∏‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶è‡¶° ‡¶π‡¶¨‡ßá‡•§
            </div>
            <button id="modal-start-btn" class="primary-btn">Start Now</button>
        </div>
    </div>

    <div id="banner-notice-modal" class="modal">
        <div class="modal-content">
            <span id="close-banner-modal-btn" class="close-modal-btn">&times;</span>
            <div class="notice-title">üì¢ Banner Task</div>
            <div id="banner-step-1">
                <p>‡¶∏‡¶æ‡¶á‡¶ü‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶®‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <button id="banner-modal-start-btn" class="primary-btn">Open Site</button>
            </div>
            <div id="banner-step-2" style="display: none;">
                <div class="upload-section">
                    <label>Proof 1:</label> <input type="file" id="proof-1" class="file-input" accept="image/*">
                    <label>Proof 2:</label> <input type="file" id="proof-2" class="file-input" accept="image/*">
                </div>
                <button id="submit-proof-btn" class="primary-btn">Submit Proof</button>
                <div id="upload-status" style="display:none; color:green; margin-top:5px;">Uploading...</div>
            </div>
        </div>
    </div>

    <script>
        // 1. FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCVfj_1OEiE3nwDRF0C4KA6QJtnXiDI544",
            authDomain: "earnfree-baad5.firebaseapp.com",
            databaseURL: "https://earnfree-baad5-default-rtdb.firebaseio.com",
            projectId: "earnfree-baad5",
            storageBucket: "earnfree-baad5.firebasestorage.app",
            messagingSenderId: "165522705204",
            appId: "1:165522705204:web:5841f3d17afd86ae077361"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. USER AUTHENTICATION & VARIABLES
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        const userData = tg.initDataUnsafe.user;
        
        // Settings
        const HOURLY_ADS_LIMIT = 20;
        const AD_REWARD = 0.02;
        const BANNER_REWARD = 0.50;
        const TIKTOK_REWARD = 0.50;
        const BOT_TOKEN = '8517755201:AAFAnwqBFjtc9NZcTdXHzUtNDEJtZ0c6OKs'; 
        const CHAT_ID = '@earnfree0t'; 

        // Dynamic Links (Will be loaded from Firebase)
        let LINKS = {
            link1: "https://google.com",
            link2: "https://google.com",
            link3: "https://google.com",
            link4: "https://google.com",
            tiktok: "https://tiktok.com"
        };

        let uniqueUserId;
        if (userData && userData.id) {
            uniqueUserId = userData.id;
        } else {
            if (!localStorage.getItem('generated_user_id')) {
                localStorage.setItem('generated_user_id', Math.floor(10000000 + Math.random() * 90000000));
            }
            uniqueUserId = localStorage.getItem('generated_user_id');
        }

        // 3. CORE FUNCTIONS
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            setupEventListeners();
        });

        function initApp() {
            // UI Setup
            document.getElementById('header-user-id').textContent = uniqueUserId;
            document.getElementById('profile-user-id').textContent = uniqueUserId;
            
            if(userData) {
                const name = `${userData.first_name || ''} ${userData.last_name || ''}`;
                document.getElementById('header-user-name').textContent = name;
                document.getElementById('profile-user-name').textContent = name;
                if(userData.photo_url) {
                    const pic = `https://api.allorigins.win/raw?url=${encodeURIComponent(userData.photo_url)}`;
                    document.getElementById('header-profile-pic').src = pic;
                    document.getElementById('profile-page-pic').src = pic;
                }
            }

            // Sync Data with Firebase
            syncUserBalance();
            syncSettings();
            checkHourlyReset();
        }

        // --- FIREBASE SYNC FUNCTIONS ---
        function syncUserBalance() {
            const userRef = db.ref('users/' + uniqueUserId);
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const balance = parseFloat(data.balance || 0).toFixed(2);
                    const ads = data.adsWatched || 0;
                    
                    document.getElementById('current-balance').textContent = `BDT ${balance}`;
                    document.getElementById('total-earnings').textContent = `BDT ${balance}`;
                    document.getElementById('profile-balance').textContent = `BDT ${balance}`;
                    document.getElementById('withdraw-balance-display').textContent = `BDT ${balance}`;
                    document.getElementById('ads-watched').textContent = ads;
                    document.getElementById('profile-ads-watched').textContent = ads;
                } else {
                    // Create New User
                    userRef.set({
                        name: userData ? userData.first_name : 'User',
                        balance: 0.00,
                        adsWatched: 0
                    });
                }
            });
        }

        function syncSettings() {
            // Load Links
            db.ref('settings/links').on('value', (snap) => {
                const data = snap.val();
                if(data) {
                    LINKS = data;
                }
            });

            // Load Notice
            db.ref('settings/notice').on('value', (snap) => {
                const notice = snap.val();
                const banner = document.getElementById('admin-notice-banner');
                if(notice && notice.trim() !== "") {
                    banner.textContent = notice;
                    banner.style.display = 'block';
                } else {
                    banner.style.display = 'none';
                }
            });
        }

        // --- REWARD LOGIC (SERVER SIDE SAFE) ---
        function handleServerReward(amount) {
            const userRef = db.ref('users/' + uniqueUserId);
            userRef.transaction((currentUser) => {
                if (currentUser) {
                    currentUser.balance = (currentUser.balance || 0) + amount;
                    currentUser.adsWatched = (currentUser.adsWatched || 0) + 1;
                }
                return currentUser;
            }, (error, committed) => {
                if (committed) {
                    // Local updates for hourly tracking
                    let hourly = parseInt(localStorage.getItem('hourlyAdsWatched') || 0) + 1;
                    localStorage.setItem('hourlyAdsWatched', hourly);
                    if(!localStorage.getItem('adSessionStart')) localStorage.setItem('adSessionStart', Date.now());
                    
                    updateHourlyUI();
                    tg.showAlert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø BDT ${amount.toFixed(2)} ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`);
                }
            });
        }

        // --- TASK HANDLING ---
        let pendingUrl = '';
        let pendingReward = 0;

        function checkHourlyLimit() {
            checkHourlyReset();
            const hourly = parseInt(localStorage.getItem('hourlyAdsWatched') || 0);
            if(hourly >= HOURLY_ADS_LIMIT) {
                tg.showAlert("Hourly limit reached! Please wait.");
                return false;
            }
            return true;
        }

        function initiateTask(urlKey, reward) {
            if(!checkHourlyLimit()) return;
            pendingUrl = LINKS[urlKey];
            pendingReward = reward;
            document.getElementById('task-notice-modal').classList.add('active');
        }

        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    document.getElementById(item.dataset.page).classList.add('active');
                    item.classList.add('active');
                });
            });

            // Buttons
            document.getElementById('start-earning-btn').onclick = () => document.querySelector('[data-page="earn-page"]').click();
            document.getElementById('withdraw-btn').onclick = () => document.querySelector('[data-page="withdraw-page"]').click();

            // Tasks
            document.getElementById('task-btn-1').onclick = () => initiateTask('link1', AD_REWARD);
            document.getElementById('task-btn-2').onclick = () => initiateTask('link2', AD_REWARD);
            document.getElementById('task-btn-3').onclick = () => initiateTask('link3', AD_REWARD);
            
            // TikTok
            document.getElementById('task-btn-tiktok').onclick = () => {
                window.open(LINKS.tiktok, '_blank');
                // One time logic check can be done locally or via DB
                setTimeout(() => handleServerReward(TIKTOK_REWARD), 5000);
            };

            // Banner Task
            document.getElementById('task-btn-4').onclick = () => {
                if(!checkHourlyLimit()) return;
                pendingUrl = LINKS.link4;
                pendingReward = BANNER_REWARD;
                document.getElementById('banner-step-1').style.display = 'block';
                document.getElementById('banner-step-2').style.display = 'none';
                document.getElementById('banner-notice-modal').classList.add('active');
            };

            // Modal Actions
            document.getElementById('close-modal-btn').onclick = () => document.getElementById('task-notice-modal').classList.remove('active');
            document.getElementById('modal-start-btn').onclick = () => {
                document.getElementById('task-notice-modal').classList.remove('active');
                window.open(pendingUrl, '_blank');
                setTimeout(() => handleServerReward(pendingReward), 3000);
            };

            document.getElementById('close-banner-modal-btn').onclick = () => document.getElementById('banner-notice-modal').classList.remove('active');
            document.getElementById('banner-modal-start-btn').onclick = () => {
                window.open(pendingUrl, '_blank');
                document.getElementById('banner-step-1').style.display = 'none';
                document.getElementById('banner-step-2').style.display = 'block';
            };

            // File Upload Logic (To Telegram Bot)
            document.getElementById('submit-proof-btn').onclick = async () => {
                const f1 = document.getElementById('proof-1').files[0];
                const f2 = document.getElementById('proof-2').files[0];
                if(!f1 || !f2) return tg.showAlert("Please select both screenshots");
                
                const btn = document.getElementById('submit-proof-btn');
                btn.disabled = true; btn.innerText = "Uploading...";
                
                try {
                    await uploadToTelegram(f1);
                    await uploadToTelegram(f2);
                    
                    document.getElementById('banner-notice-modal').classList.remove('active');
                    handleServerReward(pendingReward);
                    btn.disabled = false; btn.innerText = "Submit Proof";
                    document.getElementById('proof-1').value = ''; 
                    document.getElementById('proof-2').value = '';
                } catch(e) {
                    tg.showAlert("Upload failed. Check connection.");
                    btn.disabled = false; btn.innerText = "Try Again";
                }
            };

            // Withdraw Form
            document.getElementById('withdraw-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const amount = parseFloat(document.getElementById('withdraw-amount').value);
                const method = document.getElementById('withdraw-method').value;
                const account = document.getElementById('account-number').value;
                
                // Get current balance from DB snapshot is safest, but UI is synced
                const currentBal = parseFloat(document.getElementById('current-balance').textContent.replace('BDT ', ''));
                
                if(amount > currentBal) return tg.showAlert("Insufficient Balance!");
                if((method === 'bkash' && amount < 100) || (method === 'webmoney' && amount < 500)) {
                    return tg.showAlert("Minimum limit not reached.");
                }

                tg.showConfirm(`Confirm withdraw ${amount}?`, (ok) => {
                    if(ok) {
                        const updates = {};
                        // Deduct
                        updates['users/' + uniqueUserId + '/balance'] = currentBal - amount;
                        // Add Record
                        const key = db.ref('withdrawals').push().key;
                        updates['withdrawals/' + key] = {
                            userId: uniqueUserId,
                            amount: amount,
                            method: method,
                            account: account,
                            status: 'pending',
                            timestamp: Date.now()
                        };
                        
                        db.ref().update(updates).then(() => {
                            tg.showAlert("Request Submitted!");
                            document.getElementById('withdraw-form').reset();
                        });
                    }
                });
            });

            // Support Form
            document.getElementById('support-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const msg = document.getElementById('support-message').value;
                const txt = `üÜò Help:\nID: ${uniqueUserId}\nMsg: ${msg}`;
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ chat_id: CHAT_ID, text: txt })
                });
                tg.showAlert("Message Sent!");
                document.getElementById('support-message').value = '';
            });

            // ID Copy
            document.getElementById('header-copy-btn').onclick = () => {
                navigator.clipboard.writeText(uniqueUserId);
                tg.showAlert("ID Copied!");
            };
        }

        // Helper: Upload to Telegram
        async function uploadToTelegram(file) {
            const formData = new FormData();
            formData.append("chat_id", CHAT_ID);
            formData.append("photo", file);
            formData.append("caption", `Proof from ID: ${uniqueUserId}`);
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: "POST", body: formData });
        }

        // Helper: Time Logic
        function checkHourlyReset() {
            const start = parseInt(localStorage.getItem('adSessionStart') || 0);
            if (start > 0 && (Date.now() - start >= 3600000)) {
                localStorage.setItem('hourlyAdsWatched', 0);
                localStorage.setItem('adSessionStart', 0);
            }
            updateHourlyUI();
        }

        function updateHourlyUI() {
            const hourly = parseInt(localStorage.getItem('hourlyAdsWatched') || 0);
            document.getElementById('ad-progress-text').textContent = `Completed: ${hourly} / ${HOURLY_ADS_LIMIT}`;
            document.getElementById('ad-progress-bar').style.width = `${(hourly / HOURLY_ADS_LIMIT) * 100}%`;
        }

        // Check time every 5 sec
        setInterval(checkHourlyReset, 5000);

    </script>
    <script>
  atOptions = {
    'key' : '8c1f17019d6eee50f2a467cf4e0504b0',
    'format' : 'iframe',
    'height' : 50,
    'width' : 320,
    'params' : {}
  };
</script>
<script src="https://www.highperformanceformat.com/8c1f17019d6eee50f2a467cf4e0504b0/invoke.js"></script>
    <script>
  atOptions = {
    'key' : '9fd21081d4e32b54eac9a5adc4e78cde',
    'format' : 'iframe',
    'height' : 50,
    'width' : 320,
    'params' : {}
  };
</script>
<script src="https://www.highperformanceformat.com/9fd21081d4e32b54eac9a5adc4e78cde/invoke.js"></script>
    <script src="https://pl28080969.effectivegatecpm.com/25/91/58/259158ec586075bb49adeb886c65c438.js"></script>
    
</body>
</html>
